<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
  <!-- CSS -->
  <link rel="stylesheet" th:href="@{/css/payment/paymentRentAndStay.css}">

  <!-- 토스페이먼츠 SDK 로드 -->
  <script src="https://js.tosspayments.com/v2/standard"></script>

  <!-- Day.js - 날짜 경량 라이브러리 -->
  <script src="https://unpkg.com/dayjs@1/dayjs.min.js"></script>

  <script th:inline="javascript">
    const pInfoDto = [[${pInfoDto}]];

    console.log(pInfoDto);
  </script>
</head>

<div layout:fragment="content">
  <div class="payment-container" style="width: 1200px;">
    <div class="payment-title-container" style="display: flex; justify-content: center;">
      <img th:src="@{/image/Berry_logo.png}"
           alt="Berry Logo"
           style="width: 150px; height: 50px;">

      <h1 class="payment-title" style="line-height: 50px;">
        숙박 예약 결제
      </h1>
    </div>

    <div>
      <!-- 이용 시간 -->
      <div class="section">
        <h2 class="section-title">이용 정보</h2>
        <div class="info-box">
          <!-- 객실명 -->
          <div class="info-item">
            <span class="label">객실명</span>
            <span class="lodgeDetails roomName">[[${pInfoDto.roomName}]]</span>
          </div>

          <!-- 체크인 -->
          <div class="info-item">
            <span class="label">체크인</span>

            <!-- replace() 와 th:text 중 선택 사용 -->
            <span
              class="lodgeDetails checkInTime selectedPrint"
              th:text="${#temporals.format(pInfoDto.startDate, 'yyyy-MM-dd HH:mm')}">
              <!--체크인 : [[${pInfoDto.startDate.toString().replace("T","일 ")}]]-->
            </span>
          </div>

          <!-- 체크 아웃 -->
          <div class="info-item">
            <span class="label">체크 아웃</span>

            <span
              class="lodgeDetails checkOutTime selectedPrint"
              th:text="${#temporals.format(pInfoDto.endDate, 'yyyy-MM-dd HH:mm')}">
              <!--체크 아웃 : [[${pInfoDto.endDate.toString().replace("T","일 ")}]]-->
            </span>
          </div>

        </div>
      </div>

      <!-- 예약자 정보 -->
      <div class="section">
        <h2 class="section-title">예약자 정보</h2>
        <div class="info-box">
          <div class="info-item">
            <span class="label">예약자명</span>
            <span class="lodgeDetails userName" >[[${pInfoDto.userName}]]</span>
          </div>

          <!-- < (lt = &lt), > (gt = &gt), <= (le; less or equal), >= (ge; greater or equal) -->
          <th:block th:if="${pInfoDto.isMobileCertified}">
            <div class="info-item">
              <span class="label">연락처</span>
              <span class="lodgeDetails userPhone">[[${pInfoDto.userPhone}]]</span>
            </div>
          </th:block>

          <th:block th:unless="${pInfoDto.isMobileCertified}">
            <div class="info-item">
              <div style="display:flex; vertical-align: center;">
                <span class="label" style="margin-right:8px; line-height: 30px;">연락처</span>
                <button type="button" class="verify-btn"><a th:href="@{/user/myPage}">본인 인증</a></button>
              </div>

              <span class="lodgeDetails userPhone">[[${pInfoDto.userPhone}]]</span>
            </div>
            <div class="info-item">
              <p class="certifiedMsg">본인 인증을 진행해주세요. 본인 인증을 하지 않으면 예약이 불가능합니다.</p>
            </div>
          </th:block>

          <div class="info-item">
            <span class="label">숙박 인원</span>
            <span class="lodgeDetails guestsAmount">[[${pInfoDto.guestsAmount}]]</span>
          </div>
        </div>
      </div>


      <!-- 쿠폰이 없는 경우 -->
      <th:block th:if="${#lists.isEmpty(pInfoDto.cuponList)}">
        <script th:inline="javascript">
          const cuponExists = false;
        </script>

        <div class="section">
          <h2 class="section-title">할인 적용</h2>

          <div class="cupon-select-section">
            <label for="cupon-select1" class="cupon-label"></label>
            <select id="cupon-select1" class="cupon-select1 not-exists">
              <option value="999">사용 가능한 쿠폰이 없습니다.</option>
            </select>
          </div>
        </div>
      </th:block>


      <!-- 쿠폰이 있는 경우 -->
      <th:block th:unless="${#lists.isEmpty(pInfoDto.cuponList)}">
        <script th:inline="javascript">
          const cuponExists = true;
        </script>

        <div class="section">
          <h2 class="section-title">할인 적용</h2>

          <div class="cupon-select-section" style="margin-bottom: 30px;">
            <label for="cupon-select2" class="cupon-label">사용 가능한 쿠폰 : [[${pInfoDto.cuponCnt}]] 장</label>
            <select id="cupon-select2" class="cupon-select2 select-cupon">
              <!-- unchecked -->
              <option value="" disabled selected hidden>사용할 쿠폰을 선택하세요.</option>

              <th:block th:each="cupon : ${pInfoDto.cuponList}">
                <th:block th:switch="${cupon.cuponType}">
                  <!-- 첫 회원가입 쿠폰 -->
                  <option th:case="1" class="appliedCupon" value="3000" th:data-cupon-id="${cupon.cuponId}">
                    신규 가입 할인 쿠폰
                  </option>

                  <!-- 등급업 쿠폰 - 실버 -->
                  <option th:case="2" class="appliedCupon" value="5000" th:data-cupon-id="${cupon.cuponId}">
                    Silver 등급업 쿠폰
                  </option>

                  <!-- 등급업 쿠폰 - 골드 -->
                  <option th:case="3" class="appliedCupon" value="5000" th:data-cupon-id="${cupon.cuponId}">
                    Gold 등급업 쿠폰
                  </option>

                  <!-- 등급업 쿠폰 - 플레티넘 -->
                  <option th:case="4" class="appliedCupon" value="5000" th:data-cupon-id="${cupon.cuponId}">
                    Platinum 등급업 쿠폰
                  </option>
                </th:block>
              </th:block>
            </select>
          </div>

          <div class="cupon-box">
            <div class="info-item">
              <span class="label">쿠폰 할인</span>
              <span class="lodgeDetails usingCupon">0원</span>
            </div>
          </div>
        </div>
      </th:block>


      <!-- 결제 금액 -->
      <div class="section">
        <h2 class="section-title">최종 결제 금액</h2>
        <div class="info-box amount-box">
          <div class="info-item">
            <span class="label">주문 금액</span>
            <span class="lodgeDetails strikePrice">[[${pInfoDto.strikePrice}]]</span>
          </div>
          <div class="info-item discount">
            <span class="label">할인 금액</span>
            <span class="lodgeDetails cuponPrice">0</span>
          </div>
          <hr class="divider">
          <div class="info-item total">
            <span id="label">총 결제 금액</span>
            <span class="lodgeDetails pbpTotalAmount">[[${pInfoDto.strikePrice}]]</span>
          </div>
        </div>
      </div>


      <!-- 약관 동의 -->
      <div class="section">
        <h2 class="section-title">약관 동의</h2>
        <div class="terms-box">
          <div class="term">
            <input type="checkbox" id="terms-all" name="terms-all">
            <label for="terms-all">전체 동의</label>
          </div>
          <hr class="divider">
          <div class="term">
            <input type="checkbox" id="terms-1" name="terms-1" class="terms-req">
            <label for="terms-1">[필수] 숙소이용규칙 및 취소/환불규정 동의</label>
          </div>
          <div class="term">
            <input type="checkbox" id="terms-2" name="terms-2" class="terms-req">
            <label for="terms-2">[필수] 개인정보 수집 및 이용 동의</label>
          </div>
        </div>
      </div>


      <!-- 결제 수단 -->
      <div class="section">
        <h2 class="section-title">결제 수단</h2>

        <div class="payment-methods">
          <input type="radio" id="pay-card" name="payment" value="CARD" checked>
          <label for="pay-card">신용/체크카드</label>

          <input type="radio" id="pay-virtual" name="payment" value="VIRTUAL_ACCOUNT">
          <label for="pay-virtual">가상 계좌<br /></label>

          <input type="radio" id="pay-transfer" name="payment" value="TRANSFER">
          <label for="pay-transfer">계좌이체<br /></label>

          <input type="radio" id="pay-mobile" name="payment" value="MOBILE_PHONE">
          <label for="pay-mobile">휴대폰 결제<br /></label>

          <input type="radio" id="pay-culture" name="payment" value="CULTURE_GIFT_CERTIFICATE">
          <label for="pay-culture">상품권<br /></label>
        </div>
      </div>


      <!-- 결제 하기 버튼 -->
      <div class="payment-button-container">
        <button type="button" id="payment-button" class="payment-button" disabled>[[${pInfoDto.strikePrice}]] 원 결제하기</button>
      </div>
    </div>
  </div>



  <!-- Script -->
  <script th:inline="javascript">
    const tossClientKey = [[${tossClientKey}]]

    const tossPayments = TossPayments(tossClientKey);

    const strikePrice = [[${pInfoDto.strikePrice}]];

    const userIdInfo = [[${pInfoDto.userId}]];

    const roomIdInfo = [[${pInfoDto.roomId}]];

    const startDateInfo = [[${pInfoDto.startDate}]];

    const endDateInfo = [[${pInfoDto.endDate}]];
  </script>

  <script th:src="@{/js/payment/paymentStay.js}"></script>
</div>
